{
  "info": {
    "_postman_id": "ae2e2209-7a2c-46c6-9d4a-6758c1319125",
    "name": "Household Wishlists",
    "description": "# Introduction\nThis collection interacts with a household wishlist\n\n# Overview\nEvery request requires a G-Token key\n\n# Authentication\nThis collection doesn't require any special Authentication\n\n# Error Codes\nThe most common reason for a 403 is that the G-Token is not supplied\n\n# Rate limit\nThis API is not rate limited",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "name": "Create Household",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "4c3b3c37-3e3d-43ee-bfbc-3aefbfbb9765",
            "exec": [
              "pm.globals.set(\"householdId\", pm.response.json().id);"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "id": "3c652600-5f11-407b-aa34-a72d89a5e649",
            "exec": [
              "pm.globals.set(\"numberOfUsers\", 2);",
              "pm.globals.set(\"currentUserCount\", 0);",
              "",
              "pm.globals.set(\"numberOfWishlistAdds\", 4);",
              "pm.globals.set(\"currentWishlistCount\", 0);",
              "",
              "pm.globals.set(\"wishlistIds\", []);",
              "",
              "const getBooks = {",
              "    url: `http://${pm.environment.get(\"host\")}/books`,",
              "    method: \"GET\",",
              "    header: \"G-TOKEN:ROM831ESV\"",
              "}",
              "",
              "pm.sendRequest(getBooks, function(err, books){",
              "    const ids = _.map(books.json(), function(book){",
              "        return book.id;",
              "    });",
              "",
              "    pm.globals.set(\"bookIds\", ids)",
              "})"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "16ccadde-3350-4c3d-a1b6-2355cc8eaaf0",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content_Type",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "G-TOKEN",
            "value": "ROM831ESV",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"name\": \"Taylor Household\"\n\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": "{{host}}/households",
        "description": "This response will generate a new \\`Household\\` in the Globomantics Library API"
      },
      "response": [
        {
          "id": "dbbc4de3-bdbd-46f3-b178-cb85ebadb69d",
          "name": "Create Household",
          "originalRequest": {
            "method": "POST",
            "header": [
              {
                "key": "Content_Type",
                "value": "application/json",
                "type": "text"
              },
              {
                "key": "G-TOKEN",
                "value": "ROM831ESV",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"Taylor Household\"\n\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{host}}/households"
          },
          "_postman_previewlanguage": "json",
          "header": [
            ""
          ],
          "cookie": [
            {
              "expires": "Invalid Date"
            }
          ],
          "responseTime": null,
          "body": "{\n    \"id\": 1,\n    \"name\": \"Taylor Household\",\n    \"updatedAt\": \"2017-11-18T23:25:50.016Z\",\n    \"createdAt\": \"2017-11-18T23:25:50.016Z\",\n    \"links\": [{\n        \"rel\": \"self\",\n        \"href\": \"http://localhost:3000/households/1\"\n    }]\n}"
        }
      ]
    },
    {
      "name": "Create User",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "90dbe95d-3a06-4555-a151-3829823ec154",
            "exec": [
              "const ids = pm.globals.get(\"wishlistIds\");",
              "ids.push(pm.response.json().wishlistId);",
              "pm.globals.set(\"wishlistIds\", ids);",
              "",
              "let userCount = pm.globals.get(\"currentUserCount\");",
              "userCount++;",
              "pm.globals.set(\"currentUserCount\", userCount);",
              "",
              "if(userCount < pm.globals.get(\"numberOfUsers\")) {",
              "    postman.setNextRequest(\"Create User\");",
              "} else {",
              "    postman.setNextRequest(\"Add Book to User\");",
              "}"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "id": "f7f201b5-6ffc-4979-a964-c2094c8d8489",
            "exec": [
              "// const users = [{",
              "//     email: \"taylonr@gmail.com\",",
              "//     firstName: \"Nate\",",
              "//     lastName: \"Taylor\"",
              "// }, {",
              "//     email: \"jon@mailinator.com\",",
              "//     firstName: \"Jonathan\",",
              "//     lastName: \"Edwards\"",
              "// }, {",
              "//     email: \"brooks@mailinator.com\",",
              "//     firstName: \"Thomas\",",
              "//     lastName: \"Brooks\"",
              "// }, {",
              "//     email: \"scott@mailinator.com\",",
              "//     firstName: \"John\",",
              "//     lastName: \"Stott\"",
              "// }];",
              "",
              "const users = data.users;",
              "const user = _.sample(users);",
              "",
              "pm.globals.set(\"email\", user.email);",
              "pm.globals.set(\"firstName\", user.firstName);",
              "pm.globals.set(\"lastName\", user.lastName);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "84f7896f-69b9-468e-84f2-6b8d9e92fe5c",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content_Type",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "G-TOKEN",
            "value": "ROM831ESV",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"email\": \"{{email}}\",\n    \"firstName\": \"{{firstName}}\",\n    \"lastName\": \"{{lastName}}\",\n    \"householdId\": \"{{householdId}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": "{{host}}/users"
      },
      "response": []
    },
    {
      "name": "Create Second User",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "ec0c7478-caf2-46f7-acc2-112c7f995f1d",
            "exec": [
              "pm.globals.set(\"secondWishlistId\", pm.response.json().wishlistId);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "df7eb433-7986-4d9e-a367-43209973be22",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content_Type",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "G-TOKEN",
            "value": "ROM831ESV",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "// {\n//     \"email\": \"chip+taylonr@gmail.com\",\n//     \"firstName\": \"Chocolate Chip\",\n//     \"lastName\": \"Taylor\",\n//     \"householdId\": {{householdId}}\n// }\n\n{\n    \"email\": \"{{email}}\",\n    \"firstName\": \"{{firstName}}\",\n    \"lastName\": \"{{lastName}}\",\n    \"householdId\": \"{{householdId}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": "{{host}}/users"
      },
      "response": []
    },
    {
      "name": "Add Book to User",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "6f80bd3a-195a-4b88-bef3-bbb2b32dc990",
            "exec": [
              "const books = pm.globals.get(\"bookIds\");",
              "pm.globals.set(\"bookId\", _.sample(books));",
              "",
              "const wishlists = pm.globals.get(\"wishlistIds\");",
              "pm.globals.set(\"wishlistId\", _.sample(wishlists));",
              ""
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "e3e4c0d1-29af-4da9-83ea-03f8d41e19ce",
            "exec": [
              "let wishlistCount = pm.globals.get(\"currentWishlistCount\");",
              "wishlistCount++;",
              "pm.globals.set(\"currentWishlistCount\", wishlistCount);",
              "",
              "if(wishlistCount < pm.globals.get(\"numberOfWishlistAdds\")){",
              "    postman.setNextRequest(\"Add Book to User\");",
              "} else {",
              "    postman.setNextRequest(\"Get Household Books\");",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "686dbba6-30bc-440b-ae44-158a7f6a2975",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content_Type",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "G-TOKEN",
            "value": "ROM831ESV",
            "type": "text"
          }
        ],
        "url": "{{host}}/wishlists/{{wishlistId}}/books/{{bookId}}"
      },
      "response": []
    },
    {
      "name": "Add Book to Second User",
      "_postman_id": "00a6e35b-1a73-45b8-b6f4-bf37d165639e",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content_Type",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "G-TOKEN",
            "value": "ROM831ESV",
            "type": "text"
          }
        ],
        "url": "{{host}}/wishlists/{{secondWishlistId}}/books/25"
      },
      "response": []
    },
    {
      "name": "Get Household Books",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "33cec0a1-e3a2-46f9-8053-666e51c44b24",
            "exec": [
              "pm.globals.unset(\"householdId\");",
              "pm.globals.unset(\"numberOfUsers\");",
              "pm.globals.unset(\"currentUserCount\");",
              "pm.globals.unset(\"numberOfWishlistAdds\");",
              "pm.globals.unset(\"currentWishlistCount\");",
              "pm.globals.unset(\"wishlistIds\");",
              "pm.globals.unset(\"bookIds\");",
              "pm.globals.unset(\"email\");",
              "pm.globals.unset(\"firstName\");",
              "pm.globals.unset(\"lastName\");",
              "pm.globals.unset(\"bookId\");",
              "pm.globals.unset(\"wishlistId\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "94802f7c-baa1-4d1a-b5a9-fdbaaff80f99",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content_Type",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "G-TOKEN",
            "value": "ROM831ESV",
            "type": "text"
          }
        ],
        "url": "{{host}}/households/{{householdId}}/wishlistBooks"
      },
      "response": []
    }
  ]
}